---
layout: post
title: "项目 - 路径追踪渲染器实现过程"
subtitle: 'path tracing render'
author: "ZolHo"
header-style: text
tags:
  - 图形学
  - 项目
---


## 待填坑

- [x] 建立渲染器框架，调用时自定义采样数、分辨率、输出文件名
- [x] 实现几何`球体`、`轴对齐立方体`，以及对应的与光线求交方法
- [x] 实现材质`漫反射`、`镜面反射`、`glossy`
- [ ] 将轴对齐立方体完善成任意立方体
- [ ] 实现折射材质
- [ ] 找方法在同等采样数时降噪  

## 前言

出于增加C++代码量和深入理解图形学算法的目的，打算实现一个光线追踪渲染器。框架与算法参考学习了项目[Ray Tracing in One Weekend](https://blog.csdn.net/xiji333/article/details/108730223)，详细的过程可参考原文，本文仅记录大该概框架和实现过程中的问题。

## 实现过程

### 程序框架

- `camera`: 照像机需要实现
  - 根据给定坐标、焦距、方向等参数定义一个空间中的照相机
  - 给它屏幕uv坐标可以返回相机原点与对应像素连成的射线
- `ray`: 光线/射线需要实现
  - 根据原点和方向定义空间中的一根射线
  - 给定时间t可返回t时射线末端的位置
- `hitable`: 几何体需要实现的接口，对于给定光线，几何体应当返回光线与其是否存在交点，以及交点的位置、法线等信息
- `material`: 材质接口，其实例通过实现scatter函数表现，scatter函数会在一次入射光线照射中，返回该材质可能的一根反射光线
- `main`: 有了上述模块，就可以按以下方式就行渲染
  1. 给世界中放入一些几何体，定义这些几何体的位置、大小与材质属性
  2. 根据分辨率找到每一个像素对应的uv，通过uv获得照相机发出的光线
  3. 对每一个像素采样n次，每次采样根据打到的物体材质的scatter函数，获取下一根光线递归地进行采样
  4. 根据采样结果以某种格式绘制渲染结果

以上便是渲染器的大致的框架，除此之外还需要像`向量`类等工具支持。

### 目前效果

> 截止至22年4月18日，对于800采样次数/像素效果如下（随机采样、p=0.8的轮盘赌、光源长宽0.5）：
![220418效果图](/img/note/2022-04-18-19-18-30.png)

### 理论基础

#### 蒙特卡罗积分

#### 轮盘赌算法
